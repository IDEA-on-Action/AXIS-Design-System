# External Scout Agent - Signal 패턴 감지
# 정의된 패턴에 따라 Signal 후보를 정확히 추출하는지 테스트

task:
  id: external_scout_signal_pattern
  type: workflow
  desc: "Signal 패턴 감지 정확성 - 세미나/리포트 내용에서 Signal 패턴을 정확히 감지하는지 검증"
  suite: external_scout_regression
  version: "1.0.0"

  metadata:
    domain: data_quality
    difficulty: medium
    risk: low
    purpose: regression
    expected_pass_rate: 0.9
    owner: "ax-bd-team"
    created_at: "2026-01-18"

  inputs:
    prompt: |
      다음 세미나 AAR 내용에서 Signal 후보를 추출하세요:

      """
      AI Finance Summit 2026 참석 후기

      핵심 발표 내용:
      1. A은행: AI 도입으로 고객 상담 시간 40% 감소 달성
      2. B증권: 투자 추천 시스템 자동화 예산 확보 완료
      3. C보험: 청구 심사 자동화 니즈 증가, 솔루션 탐색 중
      4. D카드: 부정거래 탐지 정확도 향상 필요성 언급

      업계 공통 과제:
      - 레거시 시스템 통합 어려움
      - AI 모델 설명가능성 규제 대응
      """

      Signal 패턴 규칙:
      - N% 개선/감소/증가/절감
      - AI/ML/자동화 도입
      - 예산/투자 확보/계획
      - 니즈/요구/필요 + 솔루션
    context:
      source_type: "seminar_aar"
      play_id: "EXT_Desk_D01_Seminar"
      expected_signals_count: 4

  success_criteria:
    description: "Signal 패턴 매칭 규칙에 따라 후보 추출"
    outcome_checks:
      - type: state_equals
        target: "output.signals.length"
        value: 4
        description: "4개 Signal 후보 추출"

  graders:
    - type: state_check
      id: signal_detection
      weight: 0.4
      required: true
      description: "Signal 패턴 감지 검증"
      config:
        checks:
          - type: state_equals
            target: "output.signals"
            expected: 3
            operator: gte
            description: "최소 3개 Signal 감지"

    - type: llm_assertion
      id: pattern_accuracy
      weight: 0.4
      description: "패턴 매칭 정확도 검증"
      config:
        model: "claude-sonnet-4-20250514"
        assertions:
          - statement: "40% 감소 패턴이 Signal로 추출되었다"
            weight: 1.0
            required: true
          - statement: "예산 확보 관련 내용이 Signal로 추출되었다"
            weight: 1.0
            required: true
          - statement: "니즈/솔루션 탐색 내용이 Signal로 추출되었다"
            weight: 1.0
          - statement: "단순 과제 언급(레거시, 규제)은 Signal로 추출되지 않았다"
            weight: 0.8

    - type: regex_match
      id: signal_format
      weight: 0.2
      description: "Signal JSON 형식 검증"
      config:
        patterns:
          - pattern: '"signal_id":\s*"SIG-[A-Z0-9-]+"'
            target: output
            description: "signal_id 형식"
          - pattern: '"confidence":\s*0\.\d+'
            target: output
            description: "confidence 점수 존재"

  scoring:
    mode: weighted
    pass_threshold: 0.8
    required_graders:
      - signal_detection

  timeout:
    total_seconds: 180
    per_turn_seconds: 45
    grading_seconds: 60

  tags:
    - external_scout
    - signal
    - pattern-detection
    - regression
