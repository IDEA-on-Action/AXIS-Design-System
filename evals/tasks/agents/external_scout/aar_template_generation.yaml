# External Scout Agent - AAR 템플릿 생성
# 세미나 Activity에 대한 AAR 템플릿을 올바르게 생성하는지 테스트

task:
  id: external_scout_aar_template
  type: workflow
  desc: "AAR 템플릿 생성 검증 - Activity 정보를 기반으로 완전한 AAR 템플릿을 생성하는지 확인"
  suite: external_scout_regression
  version: "1.0.0"

  metadata:
    domain: functionality
    difficulty: easy
    risk: low
    purpose: regression
    expected_pass_rate: 0.95
    owner: "ax-bd-team"
    created_at: "2026-01-18"

  inputs:
    prompt: |
      다음 Activity 정보를 기반으로 AAR(After Action Review) 템플릿을 생성하세요:

      Activity:
      - title: "Cloud Tech Summit 2026"
      - date: "2026-04-20"
      - organizer: "클라우드협회"
      - play_id: "EXT_Desk_D01_Seminar"
      - themes: ["클라우드", "AI", "보안"]

      AAR 템플릿에 필수 포함 섹션:
      1. 핵심 인사이트 (3개)
      2. AX BD 관련성
      3. Follow-up Actions
      4. Signal 후보 테이블
      5. 종합 평가
    context:
      output_format: "markdown"
      play_id: "EXT_Desk_D01_Seminar"

  success_criteria:
    description: "AAR 템플릿에 필수 섹션이 모두 포함됨"
    outcome_checks:
      - type: state_equals
        target: "output.aar_template"
        value: true
        operator: ne
        description: "AAR 템플릿 생성됨"

  graders:
    - type: string_match
      id: section_check
      weight: 0.5
      required: true
      description: "필수 섹션 존재 여부"
      config:
        checks:
          - target: output
            expected: "핵심 인사이트"
            mode: contains
            description: "핵심 인사이트 섹션"
          - target: output
            expected: "AX BD 관련성"
            mode: contains
            description: "AX BD 관련성 섹션"
          - target: output
            expected: "Follow-up Actions"
            mode: contains
            description: "Follow-up Actions 섹션"
          - target: output
            expected: "Signal 후보"
            mode: contains
            description: "Signal 후보 섹션"
          - target: output
            expected: "종합 평가"
            mode: contains
            description: "종합 평가 섹션"
        all_required: true

    - type: regex_match
      id: template_format
      weight: 0.3
      description: "템플릿 형식 검증"
      config:
        patterns:
          - pattern: "Cloud Tech Summit 2026"
            target: output
            description: "제목 포함"
          - pattern: "2026-04-20"
            target: output
            description: "일시 포함"
          - pattern: "EXT_Desk_D01"
            target: output
            description: "Play ID 포함"
          - pattern: "\\[ \\]"
            target: output
            description: "체크박스 포함"

    - type: llm_assertion
      id: quality_check
      weight: 0.2
      description: "템플릿 품질 검증"
      config:
        model: "claude-sonnet-4-20250514"
        assertions:
          - statement: "AAR 템플릿이 마크다운 형식으로 작성되어 있다"
            weight: 1.0
          - statement: "템플릿에 작성자가 채워야 할 빈 필드가 적절히 표시되어 있다"
            weight: 1.0
          - statement: "Signal 후보 테이블이 구조화되어 있다"
            weight: 0.8

  scoring:
    mode: weighted
    pass_threshold: 0.85
    required_graders:
      - section_check

  timeout:
    total_seconds: 90
    per_turn_seconds: 30
    grading_seconds: 30

  tags:
    - external_scout
    - aar
    - template
    - regression
