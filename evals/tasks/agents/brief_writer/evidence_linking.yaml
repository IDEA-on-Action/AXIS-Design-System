# Brief Writer Agent - 증거 링크 자동 첨부
# Signal의 evidence를 Brief에 올바르게 연결하는지 테스트

task:
  id: brief_writer_evidence_linking
  type: workflow
  desc: "증거 링크 자동 첨부 검증 - Signal의 evidence 목록이 Brief에 올바르게 연결되고 참조 가능한지 확인"
  suite: brief_writer_capability
  version: "1.0.0"

  metadata:
    domain: data_quality
    difficulty: medium
    risk: low
    purpose: capability
    expected_pass_rate: 0.9
    owner: "ax-bd-team"
    created_at: "2026-01-18"

  inputs:
    prompt: |
      다음 Signal의 evidence를 Brief에 연결하세요:

      Signal:
      - signal_id: SIG-2026-EVD-001
      - title: 문서 자동 분류
      - evidence:
        - type: interview
          source: "고객사 담당자 인터뷰"
          url: "https://confluence.example.com/interview-001"
          date: "2026-01-10"
        - type: data
          source: "분류 오류율 데이터"
          url: "https://analytics.example.com/report/001"
          date: "2026-01-12"
        - type: benchmark
          source: "경쟁사 분석 리포트"
          url: "https://confluence.example.com/benchmark-001"
          date: "2026-01-15"

      Scorecard:
      - total_score: 72
      - recommendation: GO

      요구사항:
      - 모든 evidence가 Brief의 Evidence 섹션에 포함
      - 각 evidence에 유형, 출처, URL, 날짜 표시
      - 하이퍼링크 형식으로 URL 연결
    context:
      evidence_count: 3
      expected_types: ["interview", "data", "benchmark"]

  success_criteria:
    description: "모든 evidence가 Brief에 올바르게 연결됨"
    outcome_checks:
      - type: state_equals
        target: "output.brief.evidence.length"
        value: 3
        description: "3개 evidence 연결"

  graders:
    - type: string_match
      id: evidence_presence
      weight: 0.4
      required: true
      description: "Evidence 존재 검증"
      config:
        checks:
          - target: output
            expected: "고객사 담당자 인터뷰"
            mode: contains
            description: "인터뷰 evidence"
          - target: output
            expected: "분류 오류율 데이터"
            mode: contains
            description: "데이터 evidence"
          - target: output
            expected: "경쟁사 분석 리포트"
            mode: contains
            description: "벤치마크 evidence"
        all_required: true

    - type: regex_match
      id: url_linking
      weight: 0.3
      description: "URL 링크 형식 검증"
      config:
        patterns:
          - pattern: "\\[.*\\]\\(https://.*\\)"
            target: output
            description: "마크다운 링크 형식"
          - pattern: "https://confluence\\.example\\.com"
            target: output
            description: "Confluence URL 포함"
          - pattern: "https://analytics\\.example\\.com"
            target: output
            description: "Analytics URL 포함"

    - type: llm_assertion
      id: evidence_quality
      weight: 0.3
      description: "Evidence 연결 품질"
      config:
        model: "claude-sonnet-4-20250514"
        assertions:
          - statement: "모든 evidence에 유형(type)이 표시되어 있다"
            weight: 1.0
          - statement: "모든 evidence에 출처(source)가 명시되어 있다"
            weight: 1.0
          - statement: "모든 evidence에 날짜가 포함되어 있다"
            weight: 0.8
          - statement: "Evidence가 Brief의 주장을 뒷받침하는 방식으로 구성되어 있다"
            weight: 0.8

  scoring:
    mode: weighted
    pass_threshold: 0.8
    required_graders:
      - evidence_presence

  timeout:
    total_seconds: 150
    per_turn_seconds: 50
    grading_seconds: 45

  tags:
    - brief_writer
    - evidence
    - capability
    - linking
