# VoC Analyst Agent - Signal 생성
# 추출된 테마에서 Signal을 올바르게 생성하는지 테스트

task:
  id: voc_analyst_signal_generation
  type: workflow
  desc: "Signal 생성 검증 - 테마 분석 결과를 기반으로 Signal 후보를 올바르게 생성하는지 확인"
  suite: voc_analyst_capability
  version: "1.0.0"

  metadata:
    domain: functionality
    difficulty: medium
    risk: medium
    purpose: capability
    expected_pass_rate: 0.9
    owner: "ax-bd-team"
    created_at: "2026-01-18"

  inputs:
    prompt: |
      다음 테마 분석 결과를 기반으로 Signal을 생성하세요:

      테마 분석 결과:
      Theme 1:
        - name: "상담 대기 시간 불만"
        - frequency: 127
        - severity: HIGH
        - keywords: ["대기", "오래", "기다림"]
        - sample_texts: ["대기 시간이 너무 길어요", "30분 넘게 기다렸습니다"]

      Theme 2:
        - name: "앱 성능 이슈"
        - frequency: 85
        - severity: MEDIUM
        - keywords: ["느림", "오류", "멈춤"]
        - sample_texts: ["앱이 자주 멈춰요", "로딩이 너무 느립니다"]

      Signal 생성 요구사항:
      - 각 테마에서 Signal 후보 생성
      - pain 필드에 구체적인 문제 기술
      - kpi_hypothesis에 개선 가능한 KPI 제안
      - evidence에 VoC 데이터 기반 근거 포함
    context:
      play_id: "KT_Desk_V01_VoC"
      source: "KT"
      channel: "데스크리서치"

  success_criteria:
    description: "테마당 1개 이상 Signal 생성"
    outcome_checks:
      - type: state_equals
        target: "output.signals.length"
        value: 2
        operator: gte
        description: "2개 이상 Signal 생성"

  graders:
    - type: state_check
      id: signal_count
      weight: 0.3
      required: true
      description: "Signal 개수 검증"
      config:
        checks:
          - type: state_equals
            target: "output.signals"
            expected: 2
            operator: gte
            description: "2개 이상 Signal"

    - type: llm_rubric
      id: signal_quality
      weight: 0.5
      description: "Signal 품질 평가"
      config:
        model: "claude-sonnet-4-20250514"
        dimensions:
          - name: "Pain 구체성"
            description: "Signal의 pain 필드가 테마의 문제를 구체적으로 기술하는지"
            weight: 0.3
            scale_min: 1
            scale_max: 5
          - name: "KPI 적절성"
            description: "제안된 KPI가 측정 가능하고 실현 가능한지"
            weight: 0.3
            scale_min: 1
            scale_max: 5
          - name: "Evidence 연결성"
            description: "VoC 데이터가 Signal의 근거로 적절히 연결되었는지"
            weight: 0.2
            scale_min: 1
            scale_max: 5
          - name: "테마-Signal 일관성"
            description: "추출된 테마와 생성된 Signal이 논리적으로 연결되는지"
            weight: 0.2
            scale_min: 1
            scale_max: 5

    - type: regex_match
      id: signal_format
      weight: 0.2
      description: "Signal 형식 검증"
      config:
        patterns:
          - pattern: '"signal_id":\s*"SIG-VOC-[0-9]+"'
            target: output
            description: "signal_id 형식"
          - pattern: '"theme_id":\s*"THM-[0-9]+"'
            target: output
            description: "theme_id 연결"
          - pattern: '"kpi_hypothesis":\s*\['
            target: output
            description: "kpi_hypothesis 배열"
          - pattern: '"evidence":\s*\['
            target: output
            description: "evidence 배열"

  scoring:
    mode: weighted
    pass_threshold: 0.8
    required_graders:
      - signal_count

  timeout:
    total_seconds: 180
    per_turn_seconds: 60
    grading_seconds: 60

  tags:
    - voc_analyst
    - signal
    - capability
    - generation
