# Orchestrator Agent - 서브에이전트 호출 순서 검증
# 의존성이 있는 서브에이전트 호출이 올바른 순서로 실행되는지 테스트

task:
  id: orchestrator_subagent_call_order
  type: workflow
  desc: "서브에이전트 호출 순서 검증 - Signal 평가 후 Brief 생성 순서가 올바르게 지켜지는지 테스트"
  suite: orchestrator_capability
  version: "1.0.0"

  metadata:
    domain: functionality
    difficulty: medium
    risk: medium
    purpose: capability
    expected_pass_rate: 0.95
    owner: "ax-bd-team"
    created_at: "2026-01-18"

  inputs:
    prompt: |
      Inbound Triage(WF-04) 워크플로를 실행하세요.

      입력 Signal 데이터:
      - signal_id: SIG-2026-001
      - title: 콜센터 AHT 최적화
      - customer_segment: 금융 콜센터
      - pain: 평균 통화 시간 8분으로 비용 증가

      서브에이전트 호출 순서:
      1. scorecard_evaluator로 Signal 평가
      2. GO 판정 시 brief_writer로 Brief 생성
      3. confluence_sync로 동기화
    context:
      workflow_id: "WF-04"
      expected_call_order:
        - "scorecard_evaluator"
        - "brief_writer"
        - "confluence_sync"

  success_criteria:
    description: "서브에이전트가 올바른 순서로 호출됨"
    outcome_checks:
      - type: state_equals
        target: "call_order[0]"
        value: "scorecard_evaluator"
        description: "첫 번째로 Scorecard 평가"
      - type: state_equals
        target: "call_order[1]"
        value: "brief_writer"
        description: "두 번째로 Brief 생성"

  graders:
    - type: tool_call_check
      id: call_order_check
      weight: 0.5
      required: true
      description: "호출 순서 검증"
      config:
        required_calls:
          - tool: "call_agent"
            min_count: 1
            args_match:
              agent_name: "scorecard_evaluator"
          - tool: "call_agent"
            min_count: 1
            args_match:
              agent_name: "brief_writer"
          - tool: "call_agent"
            min_count: 1
            args_match:
              agent_name: "confluence_sync"
        call_order:
          - "scorecard_evaluator"
          - "brief_writer"
          - "confluence_sync"
        check_order: true

    - type: llm_assertion
      id: logic_check
      weight: 0.3
      description: "비즈니스 로직 준수 확인"
      config:
        model: "claude-sonnet-4-20250514"
        assertions:
          - statement: "Scorecard 평가가 Brief 생성보다 먼저 수행되었다"
            weight: 1.0
            required: true
          - statement: "GO 판정을 받은 경우에만 Brief 생성이 진행되었다"
            weight: 1.0
            required: true
          - statement: "모든 작업 후 Confluence 동기화가 수행되었다"
            weight: 0.8

    - type: transcript_metrics
      id: efficiency
      weight: 0.2
      description: "실행 효율성"
      config:
        thresholds:
          max_turns: 15
          max_tool_calls: 30

  scoring:
    mode: weighted
    pass_threshold: 0.8
    required_graders:
      - call_order_check

  timeout:
    total_seconds: 240
    per_turn_seconds: 45
    grading_seconds: 60

  tags:
    - orchestrator
    - call-order
    - capability
    - wf-04
