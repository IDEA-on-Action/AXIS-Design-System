{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "EvalTask",
  "description": "AI 에이전트 평가 Task 정의 스키마",
  "type": "object",
  "required": ["task"],
  "properties": {
    "task": {
      "type": "object",
      "required": ["id", "type", "desc", "suite", "graders", "scoring"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z0-9_-]+$",
          "minLength": 3,
          "maxLength": 100,
          "description": "Task 고유 ID (소문자, 숫자, 하이픈, 언더스코어만 허용)"
        },
        "type": {
          "type": "string",
          "enum": ["coding", "workflow", "conversational", "research", "computer_use"],
          "description": "Task 유형"
        },
        "desc": {
          "type": "string",
          "maxLength": 500,
          "description": "Task 설명"
        },
        "suite": {
          "type": "string",
          "description": "소속 Suite ID"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "default": "1.0.0"
        },
        "metadata": {
          "$ref": "#/$defs/TaskMetadata"
        },
        "inputs": {
          "$ref": "#/$defs/TaskInputs"
        },
        "success_criteria": {
          "$ref": "#/$defs/SuccessCriteria"
        },
        "trials": {
          "$ref": "#/$defs/TrialConfig"
        },
        "environment": {
          "$ref": "#/$defs/EnvironmentConfig"
        },
        "agent": {
          "$ref": "#/$defs/AgentConfig"
        },
        "graders": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/GraderConfig"
          }
        },
        "scoring": {
          "$ref": "#/$defs/ScoringConfig"
        },
        "timeout": {
          "$ref": "#/$defs/TimeoutConfig"
        },
        "tags": {
          "type": "array",
          "items": {"type": "string"}
        }
      },
      "additionalProperties": false
    }
  },
  "$defs": {
    "TaskMetadata": {
      "type": "object",
      "properties": {
        "domain": {
          "type": "string",
          "enum": ["security", "performance", "functionality", "ux", "integration", "data_quality"]
        },
        "difficulty": {
          "type": "string",
          "enum": ["trivial", "easy", "medium", "hard", "expert"],
          "default": "medium"
        },
        "risk": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"],
          "default": "low"
        },
        "purpose": {
          "type": "string",
          "enum": ["capability", "regression"]
        },
        "expected_pass_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "owner": {
          "type": "string"
        }
      }
    },
    "TaskInputs": {
      "type": "object",
      "properties": {
        "prompt": {
          "type": "string"
        },
        "prompt_file": {
          "type": "string"
        },
        "context": {
          "type": "object",
          "additionalProperties": true
        },
        "files": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["path"],
            "properties": {
              "path": {"type": "string"},
              "content": {"type": "string"},
              "content_file": {"type": "string"}
            }
          }
        },
        "environment_variables": {
          "type": "object",
          "additionalProperties": {"type": "string"}
        }
      }
    },
    "SuccessCriteria": {
      "type": "object",
      "properties": {
        "description": {
          "type": "string"
        },
        "outcome_checks": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["type"],
            "properties": {
              "type": {
                "type": "string",
                "enum": ["file_exists", "file_contains", "file_not_contains", "command_succeeds", "command_output_contains", "db_row_exists", "api_returns", "state_equals"]
              },
              "target": {"type": "string"},
              "value": {},
              "description": {"type": "string"}
            }
          }
        },
        "negative_checks": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": {"type": "string"},
              "target": {"type": "string"},
              "value": {},
              "description": {"type": "string"}
            }
          }
        }
      }
    },
    "TrialConfig": {
      "type": "object",
      "properties": {
        "k": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "default": 5
        },
        "seeds": {
          "type": "array",
          "items": {"type": "integer"}
        },
        "parallel": {
          "type": "boolean",
          "default": true
        },
        "stop_on_first_pass": {
          "type": "boolean",
          "default": false
        }
      }
    },
    "EnvironmentConfig": {
      "type": "object",
      "properties": {
        "sandbox": {
          "type": "string",
          "enum": ["none", "process", "container", "vm"],
          "default": "container"
        },
        "image": {
          "type": "string"
        },
        "reset": {
          "type": "string",
          "enum": ["clean", "snapshot", "persist"],
          "default": "clean"
        },
        "network": {
          "type": "string",
          "enum": ["none", "internal", "external"],
          "default": "internal"
        },
        "working_dir": {
          "type": "string"
        }
      }
    },
    "AgentConfig": {
      "type": "object",
      "properties": {
        "adapter": {
          "type": "string",
          "enum": ["claude_agent_sdk", "claude_code", "langchain", "custom"],
          "default": "claude_agent_sdk"
        },
        "agent_id": {
          "type": "string"
        },
        "model": {
          "type": "string"
        },
        "tools_allowed": {
          "type": "array",
          "items": {"type": "string"}
        },
        "tools_denied": {
          "type": "array",
          "items": {"type": "string"}
        },
        "max_turns": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "default": 20
        },
        "max_tool_calls": {
          "type": "integer",
          "minimum": 1,
          "maximum": 500,
          "default": 50
        }
      }
    },
    "GraderConfig": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "deterministic_tests",
            "static_analysis",
            "string_match",
            "regex_match",
            "tool_call_check",
            "state_check",
            "transcript_metrics",
            "latency_check",
            "llm_rubric",
            "llm_assertion",
            "llm_pairwise",
            "llm_reference",
            "human_review"
          ]
        },
        "id": {
          "type": "string"
        },
        "weight": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 1.0
        },
        "required": {
          "type": "boolean",
          "default": false
        },
        "config": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "ScoringConfig": {
      "type": "object",
      "required": ["mode"],
      "properties": {
        "mode": {
          "type": "string",
          "enum": ["weighted", "binary", "hybrid", "partial_credit"]
        },
        "pass_threshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 0.8
        },
        "required_graders": {
          "type": "array",
          "items": {"type": "string"}
        }
      }
    },
    "TimeoutConfig": {
      "type": "object",
      "properties": {
        "total_seconds": {
          "type": "integer",
          "minimum": 1,
          "maximum": 3600,
          "default": 300
        },
        "per_turn_seconds": {
          "type": "integer",
          "minimum": 1,
          "maximum": 300,
          "default": 60
        },
        "grading_seconds": {
          "type": "integer",
          "minimum": 1,
          "maximum": 600,
          "default": 120
        }
      }
    }
  },
  "additionalProperties": false
}
