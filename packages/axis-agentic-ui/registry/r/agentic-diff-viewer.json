{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "agentic-diff-viewer",
  "type": "registry:ui",
  "title": "Diff Viewer",
  "description": "코드 변경사항 비교 표시 컴포넌트",
  "dependencies": [],
  "registryDependencies": [],
  "files": [
    {
      "path": "components/agentic/diff-viewer.tsx",
      "type": "registry:ui",
      "content": "import * as React from \"react\";\nimport { cn } from \"@axis-ds/ui-react\";\nimport { DIFF_LABELS } from \"../constants/a11y-labels\";\n\nexport type DiffViewMode = \"unified\" | \"split\";\n\nexport interface DiffViewerProps {\n  /** 변경 전 코드 */\n  before: string;\n  /** 변경 후 코드 */\n  after: string;\n  /** 파일명 */\n  filename?: string;\n  /** 표시 모드 */\n  viewMode?: DiffViewMode;\n  /** 추가 클래스 */\n  className?: string;\n}\n\ntype DiffLineType = \"added\" | \"removed\" | \"unchanged\";\n\ninterface DiffLine {\n  type: DiffLineType;\n  content: string;\n  oldLineNumber?: number;\n  newLineNumber?: number;\n}\n\n/** LCS 기반 diff 알고리즘 */\nfunction computeDiff(before: string, after: string): DiffLine[] {\n  const oldLines = before.split(\"\\n\");\n  const newLines = after.split(\"\\n\");\n  const m = oldLines.length;\n  const n = newLines.length;\n\n  // LCS 테이블 구축\n  const dp: number[][] = Array.from({ length: m + 1 }, () => Array(n + 1).fill(0));\n  for (let i = 1; i <= m; i++) {\n    for (let j = 1; j <= n; j++) {\n      if (oldLines[i - 1] === newLines[j - 1]) {\n        dp[i][j] = dp[i - 1][j - 1] + 1;\n      } else {\n        dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);\n      }\n    }\n  }\n\n  // 역추적으로 diff 생성\n  const result: DiffLine[] = [];\n  let i = m;\n  let j = n;\n\n  while (i > 0 || j > 0) {\n    if (i > 0 && j > 0 && oldLines[i - 1] === newLines[j - 1]) {\n      result.unshift({ type: \"unchanged\", content: oldLines[i - 1], oldLineNumber: i, newLineNumber: j });\n      i--;\n      j--;\n    } else if (j > 0 && (i === 0 || dp[i][j - 1] >= dp[i - 1][j])) {\n      result.unshift({ type: \"added\", content: newLines[j - 1], newLineNumber: j });\n      j--;\n    } else if (i > 0) {\n      result.unshift({ type: \"removed\", content: oldLines[i - 1], oldLineNumber: i });\n      i--;\n    }\n  }\n\n  return result;\n}\n\nconst lineTypeStyles: Record<DiffLineType, string> = {\n  added: \"bg-[var(--axis-color-green-500)]/10\",\n  removed: \"bg-[var(--axis-color-red-500)]/10\",\n  unchanged: \"\",\n};\n\nconst lineTypeTextStyles: Record<DiffLineType, string> = {\n  added: \"text-[var(--axis-color-green-600)]\",\n  removed: \"text-[var(--axis-color-red-600)]\",\n  unchanged: \"text-[var(--axis-text-primary)]\",\n};\n\nconst lineTypeSymbols: Record<DiffLineType, string> = {\n  added: \"+\",\n  removed: \"-\",\n  unchanged: \" \",\n};\n\n/**\n * 코드 변경사항 비교 표시 컴포넌트\n */\nexport function DiffViewer({\n  before,\n  after,\n  filename,\n  viewMode = \"unified\",\n  className,\n}: DiffViewerProps) {\n  const [mode, setMode] = React.useState<DiffViewMode>(viewMode);\n  const diffLines = React.useMemo(() => computeDiff(before, after), [before, after]);\n\n  const addedCount = diffLines.filter((l) => l.type === \"added\").length;\n  const removedCount = diffLines.filter((l) => l.type === \"removed\").length;\n\n  return (\n    <div\n      role=\"region\"\n      aria-label={filename ? `${filename} 변경사항` : \"코드 변경사항\"}\n      className={cn(\n        \"rounded-lg border overflow-hidden\",\n        \"bg-[var(--axis-surface-default)] border-[var(--axis-border-default)]\",\n        className\n      )}\n    >\n      {/* 헤더 */}\n      <div className=\"flex items-center justify-between px-3 py-2 border-b border-[var(--axis-border-default)] bg-[var(--axis-surface-secondary)]\">\n        <div className=\"flex items-center gap-2 min-w-0\">\n          <svg className=\"w-4 h-4 text-[var(--axis-icon-secondary)]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h7\" />\n          </svg>\n          {filename && (\n            <code className=\"text-xs font-mono text-[var(--axis-text-primary)] truncate\">{filename}</code>\n          )}\n          <span className=\"text-xs text-[var(--axis-color-green-500)]\" aria-label={`${addedCount}줄 ${DIFF_LABELS.added}`}>\n            +{addedCount}\n          </span>\n          <span className=\"text-xs text-[var(--axis-color-red-500)]\" aria-label={`${removedCount}줄 ${DIFF_LABELS.removed}`}>\n            -{removedCount}\n          </span>\n        </div>\n        <div className=\"flex items-center gap-1 bg-[var(--axis-surface-tertiary)] rounded-md p-0.5\">\n          <button\n            onClick={() => setMode(\"unified\")}\n            aria-pressed={mode === \"unified\"}\n            className={cn(\n              \"px-2 py-0.5 text-xs rounded transition-colors\",\n              mode === \"unified\"\n                ? \"bg-[var(--axis-surface-default)] text-[var(--axis-text-primary)] shadow-sm\"\n                : \"text-[var(--axis-text-tertiary)] hover:text-[var(--axis-text-secondary)]\"\n            )}\n          >\n            통합\n          </button>\n          <button\n            onClick={() => setMode(\"split\")}\n            aria-pressed={mode === \"split\"}\n            className={cn(\n              \"px-2 py-0.5 text-xs rounded transition-colors\",\n              mode === \"split\"\n                ? \"bg-[var(--axis-surface-default)] text-[var(--axis-text-primary)] shadow-sm\"\n                : \"text-[var(--axis-text-tertiary)] hover:text-[var(--axis-text-secondary)]\"\n            )}\n          >\n            분할\n          </button>\n        </div>\n      </div>\n\n      {/* Diff 본문 */}\n      <div className=\"overflow-auto\">\n        {mode === \"unified\" ? (\n          <UnifiedView lines={diffLines} />\n        ) : (\n          <SplitView lines={diffLines} />\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction UnifiedView({ lines }: { lines: DiffLine[] }) {\n  return (\n    <table className=\"w-full text-xs font-mono border-collapse\" role=\"presentation\">\n      <tbody>\n        {lines.map((line, i) => (\n          <tr key={i} className={lineTypeStyles[line.type]}>\n            <td className=\"select-none text-right px-2 py-0.5 text-[var(--axis-text-tertiary)] w-10 border-r border-[var(--axis-border-default)]\">\n              {line.oldLineNumber ?? \"\"}\n            </td>\n            <td className=\"select-none text-right px-2 py-0.5 text-[var(--axis-text-tertiary)] w-10 border-r border-[var(--axis-border-default)]\">\n              {line.newLineNumber ?? \"\"}\n            </td>\n            <td className={cn(\"select-none w-4 text-center py-0.5\", lineTypeTextStyles[line.type])}>\n              {lineTypeSymbols[line.type]}\n            </td>\n            <td className={cn(\"px-2 py-0.5 whitespace-pre\", lineTypeTextStyles[line.type])}>\n              {line.content}\n            </td>\n          </tr>\n        ))}\n      </tbody>\n    </table>\n  );\n}\n\nfunction SplitView({ lines }: { lines: DiffLine[] }) {\n  // 왼쪽: removed + unchanged, 오른쪽: added + unchanged\n  const leftLines: (DiffLine | null)[] = [];\n  const rightLines: (DiffLine | null)[] = [];\n\n  for (const line of lines) {\n    if (line.type === \"unchanged\") {\n      leftLines.push(line);\n      rightLines.push(line);\n    } else if (line.type === \"removed\") {\n      leftLines.push(line);\n      rightLines.push(null);\n    } else {\n      leftLines.push(null);\n      rightLines.push(line);\n    }\n  }\n\n  return (\n    <table className=\"w-full text-xs font-mono border-collapse\" role=\"presentation\">\n      <tbody>\n        {leftLines.map((leftLine, i) => {\n          const rightLine = rightLines[i];\n          return (\n            <tr key={i}>\n              {/* 왼쪽 (before) */}\n              <td className={cn(\"select-none text-right px-2 py-0.5 text-[var(--axis-text-tertiary)] w-10 border-r border-[var(--axis-border-default)]\", leftLine ? lineTypeStyles[leftLine.type] : \"\")}>\n                {leftLine?.oldLineNumber ?? \"\"}\n              </td>\n              <td className={cn(\"select-none w-4 text-center py-0.5\", leftLine ? lineTypeTextStyles[leftLine.type] : \"\")}>\n                {leftLine ? lineTypeSymbols[leftLine.type] : \"\"}\n              </td>\n              <td className={cn(\"px-2 py-0.5 whitespace-pre w-1/2 border-r border-[var(--axis-border-default)]\", leftLine ? cn(lineTypeStyles[leftLine.type], lineTypeTextStyles[leftLine.type]) : \"\")}>\n                {leftLine?.content ?? \"\"}\n              </td>\n              {/* 오른쪽 (after) */}\n              <td className={cn(\"select-none text-right px-2 py-0.5 text-[var(--axis-text-tertiary)] w-10 border-r border-[var(--axis-border-default)]\", rightLine ? lineTypeStyles[rightLine.type] : \"\")}>\n                {rightLine?.newLineNumber ?? \"\"}\n              </td>\n              <td className={cn(\"select-none w-4 text-center py-0.5\", rightLine ? lineTypeTextStyles[rightLine.type] : \"\")}>\n                {rightLine ? lineTypeSymbols[rightLine.type] : \"\"}\n              </td>\n              <td className={cn(\"px-2 py-0.5 whitespace-pre w-1/2\", rightLine ? cn(lineTypeStyles[rightLine.type], lineTypeTextStyles[rightLine.type]) : \"\")}>\n                {rightLine?.content ?? \"\"}\n              </td>\n            </tr>\n          );\n        })}\n      </tbody>\n    </table>\n  );\n}\n"
    }
  ]
}